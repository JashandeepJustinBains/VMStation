
TASK [Display Flannel status] **************************************************
task path: /srv/monitoring_data/VMStation/ansible/playbooks/verify-cluster.yml:109
ok: [masternode] => (item={'metadata': {'name': 'kube-flannel-ds-fmxpq', 'generateName': 'kube-flannel-ds-', 'namespace': 'kube-flannel', 'uid': '2586317a-77fa-4bd8-9821-80c4ab06f962', 'resourceVersion': '201896', 'creationTimestamp': '2025-09-12T13:33:50Z', 'labels': {'app': 'flannel', 'controller-revision-hash': '5cc678f779', 'k8s-app': 'flannel', 'pod-template-generation': '2', 'tier': 'node'}, 'ownerReferences': [{'apiVersion': 'apps/v1', 'kind': 'DaemonSet', 'name': 'kube-flannel-ds', 'uid': '498c66ad-8d8f-4b82-abce-7eff1439f0f1', 'controller': True, 'blockOwnerDeletion': True}], 'managedFields': [{'manager': 'kube-controller-manager', 'operation': 'Update', 'apiVersion': 'v1', 'time': '2025-09-12T13:33:50Z', 'fieldsType': 'FieldsV1', 'fieldsV1': {'f:metadata': {'f:generateName': {}, 'f:labels': {'.': {}, 'f:app': {}, 'f:controller-revision-hash': {}, 'f:k8s-app': {}, 'f:pod-template-generation': {}, 'f:tier': {}}, 'f:ownerReferences': {'.': {}, 'k:{"uid":"498c66ad-8d8f-4b82-abce-7eff1439f0f1"}': {}}}, 'f:spec': {'f:affinity': {'.': {}, 'f:nodeAffinity': {'.': {}, 'f:requiredDuringSchedulingIgnoredDuringExecution': {}}}, 'f:containers': {'k:{"name":"kube-flannel"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:env': {'.': {}, 'k:{"name":"CONT_WHEN_CACHE_NOT_READY"}': {'.': {}, 'f:name': {}, 'f:value': {}}, 'k:{"name":"EVENT_QUEUE_DEPTH"}': {'.': {}, 'f:name': {}, 'f:value': {}}, 'k:{"name":"POD_NAME"}': {'.': {}, 'f:name': {}, 'f:valueFrom': {'.': {}, 'f:fieldRef': {}}}, 'k:{"name":"POD_NAMESPACE"}': {'.': {}, 'f:name': {}, 'f:valueFrom': {'.': {}, 'f:fieldRef': {}}}}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {'.': {}, 'f:requests': {'.': {}, 'f:cpu': {}, 'f:memory': {}}}, 'f:securityContext': {'.': {}, 'f:capabilities': {'.': {}, 'f:add': {}}, 'f:privileged': {}}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/etc/kube-flannel/"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/run/flannel"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/run/xtables.lock"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}}, 'f:dnsPolicy': {}, 'f:enableServiceLinks': {}, 'f:hostNetwork': {}, 'f:initContainers': {'.': {}, 'k:{"name":"install-cni"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/etc/cni/net.d"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/etc/kube-flannel/"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}, 'k:{"name":"install-cni-plugin"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/opt/cni/bin"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}}, 'f:priorityClassName': {}, 'f:restartPolicy': {}, 'f:schedulerName': {}, 'f:securityContext': {}, 'f:serviceAccount': {}, 'f:serviceAccountName': {}, 'f:terminationGracePeriodSeconds': {}, 'f:tolerations': {}, 'f:volumes': {'.': {}, 'k:{"name":"cni"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"cni-plugin"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"flannel-cfg"}': {'.': {}, 'f:configMap': {'.': {}, 'f:defaultMode': {}, 'f:name': {}}, 'f:name': {}}, 'k:{"name":"run"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"xtables-lock"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}}}}}, {'manager': 'kubelet', 'operation': 'Update', 'apiVersion': 'v1', 'time': '2025-09-12T13:33:59Z', 'fieldsType': 'FieldsV1', 'fieldsV1': {'f:status': {'f:conditions': {'k:{"type":"ContainersReady"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"Initialized"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"PodReadyToStartContainers"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"Ready"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}}, 'f:containerStatuses': {}, 'f:hostIP': {}, 'f:hostIPs': {}, 'f:initContainerStatuses': {}, 'f:phase': {}, 'f:podIP': {}, 'f:podIPs': {'.': {}, 'k:{"ip":"192.168.4.63"}': {'.': {}, 'f:ip': {}}}, 'f:startTime': {}}}, 'subresource': 'status'}]}, 'spec': {'volumes': [{'name': 'run', 'hostPath': {'path': '/run/flannel', 'type': ''}}, {'name': 'cni-plugin', 'hostPath': {'path': '/opt/cni/bin', 'type': ''}}, {'name': 'cni', 'hostPath': {'path': '/etc/cni/net.d', 'type': ''}}, {'name': 'flannel-cfg', 'configMap': {'name': 'kube-flannel-cfg', 'defaultMode': 420}}, {'name': 'xtables-lock', 'hostPath': {'path': '/run/xtables.lock', 'type': 'FileOrCreate'}}, {'name': 'kube-api-access-p57f5', 'projected': {'sources': [{'serviceAccountToken': {'expirationSeconds': 3607, 'path': 'token'}}, {'configMap': {'name': 'kube-root-ca.crt', 'items': [{'key': 'ca.crt', 'path': 'ca.crt'}]}}, {'downwardAPI': {'items': [{'path': 'namespace', 'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.namespace'}}]}}], 'defaultMode': 420}}], 'initContainers': [{'name': 'install-cni-plugin', 'image': 'docker.io/flannel/flannel-cni-plugin:v1.4.0-flannel1', 'command': ['cp'], 'args': ['-f', '/flannel', '/opt/cni/bin/flannel'], 'resources': {}, 'volumeMounts': [{'name': 'cni-plugin', 'mountPath': '/opt/cni/bin'}, {'name': 'kube-api-access-p57f5', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent'}, {'name': 'install-cni', 'image': 'docker.io/flannel/flannel:v0.24.2', 'command': ['cp'], 'args': ['-f', '/etc/kube-flannel/cni-conf.json', '/etc/cni/net.d/10-flannel.conflist'], 'resources': {}, 'volumeMounts': [{'name': 'cni', 'mountPath': '/etc/cni/net.d'}, {'name': 'flannel-cfg', 'mountPath': '/etc/kube-flannel/'}, {'name': 'kube-api-access-p57f5', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent'}], 'containers': [{'name': 'kube-flannel', 'image': 'docker.io/flannel/flannel:v0.24.2', 'command': ['/opt/bin/flanneld'], 'args': ['--ip-masq', '--kube-subnet-mgr'], 'env': [{'name': 'POD_NAME', 'valueFrom': {'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.name'}}}, {'name': 'POD_NAMESPACE', 'valueFrom': {'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.namespace'}}}, {'name': 'EVENT_QUEUE_DEPTH', 'value': '5000'}, {'name': 'CONT_WHEN_CACHE_NOT_READY', 'value': 'false'}], 'resources': {'requests': {'cpu': '100m', 'memory': '50Mi'}}, 'volumeMounts': [{'name': 'run', 'mountPath': '/run/flannel'}, {'name': 'flannel-cfg', 'mountPath': '/etc/kube-flannel/'}, {'name': 'xtables-lock', 'mountPath': '/run/xtables.lock'}, {'name': 'kube-api-access-p57f5', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent', 'securityContext': {'capabilities': {'add': ['NET_ADMIN', 'NET_RAW']}, 'privileged': False}}], 'restartPolicy': 'Always', 'terminationGracePeriodSeconds': 30, 'dnsPolicy': 'ClusterFirst', 'serviceAccountName': 'flannel', 'serviceAccount': 'flannel', 'nodeName': 'masternode', 'hostNetwork': True, 'securityContext': {}, 'affinity': {'nodeAffinity': {'requiredDuringSchedulingIgnoredDuringExecution': {'nodeSelectorTerms': [{'matchFields': [{'key': 'metadata.name', 'operator': 'In', 'values': ['masternode']}]}]}}}, 'schedulerName': 'default-scheduler', 'tolerations': [{'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/not-ready', 'operator': 'Exists', 'effect': 'NoExecute'}, {'key': 'node.kubernetes.io/unreachable', 'operator': 'Exists', 'effect': 'NoExecute'}, {'key': 'node.kubernetes.io/disk-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/memory-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/pid-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/unschedulable', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/network-unavailable', 'operator': 'Exists', 'effect': 'NoSchedule'}], 'priorityClassName': 'system-node-critical', 'priority': 2000001000, 'enableServiceLinks': True, 'preemptionPolicy': 'PreemptLowerPriority'}, 'status': {'phase': 'Running', 'conditions': [{'type': 'PodReadyToStartContainers', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:33:53Z'}, {'type': 'Initialized', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:33:58Z'}, {'type': 'Ready', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:33:59Z'}, {'type': 'ContainersReady', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:33:59Z'}, {'type': 'PodScheduled', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:33:50Z'}], 'hostIP': '192.168.4.63', 'hostIPs': [{'ip': '192.168.4.63'}], 'podIP': '192.168.4.63', 'podIPs': [{'ip': '192.168.4.63'}], 'startTime': '2025-09-12T13:33:50Z', 'initContainerStatuses': [{'name': 'install-cni-plugin', 'state': {'terminated': {'exitCode': 0, 'reason': 'Completed', 'startedAt': '2025-09-12T13:33:52Z', 'finishedAt': '2025-09-12T13:33:52Z', 'containerID': 'containerd://9218ca8b78b862240d08a6b72a257c08fed1cd6dfd8ec6bc4d4b792c0969d057'}}, 'lastState': {}, 'ready': True, 'restartCount': 0, 'image': 'docker.io/flannel/flannel-cni-plugin:v1.4.0-flannel1', 'imageID': 'docker.io/flannel/flannel-cni-plugin@sha256:743c25e5e477527d8e54faa3e5259fbbee3463a335de1690879fc74305edc79b', 'containerID': 'containerd://9218ca8b78b862240d08a6b72a257c08fed1cd6dfd8ec6bc4d4b792c0969d057', 'started': False}, {'name': 'install-cni', 'state': {'terminated': {'exitCode': 0, 'reason': 'Completed', 'startedAt': '2025-09-12T13:33:57Z', 'finishedAt': '2025-09-12T13:33:57Z', 'containerID': 'containerd://968310553ecc5539f7bb0853108d6905d733b332d31955c05b967ee2e0fc9313'}}, 'lastState': {}, 'ready': True, 'restartCount': 0, 'image': 'docker.io/flannel/flannel:v0.24.2', 'imageID': 'docker.io/flannel/flannel@sha256:2a2b74a762a5d99517659f940e3f2ad774de293d41fce6a78378df6fe9320173', 'containerID': 'containerd://968310553ecc5539f7bb0853108d6905d733b332d31955c05b967ee2e0fc9313', 'started': False}], 'containerStatuses': [{'name': 'kube-flannel', 'state': {'running': {'startedAt': '2025-09-12T13:33:58Z'}}, 'lastState': {}, 'ready': True, 'restartCount': 0, 'image': 'docker.io/flannel/flannel:v0.24.2', 'imageID': 'docker.io/flannel/flannel@sha256:2a2b74a762a5d99517659f940e3f2ad774de293d41fce6a78378df6fe9320173', 'containerID': 'containerd://33285268119196e7bc2d01a2d4c1fc24889b5cdcdc2dcea18c2f32bf714e9c78', 'started': True}], 'qosClass': 'Burstable'}, 'apiVersion': 'v1', 'kind': 'Pod'}) =>
  msg: Flannel pod kube-flannel-ds-fmxpq on node masternode is Running
ok: [masternode] => (item={'metadata': {'name': 'kube-flannel-ds-hns7m', 'generateName': 'kube-flannel-ds-', 'namespace': 'kube-flannel', 'uid': '1fc6bc2f-e94a-4f81-ab3f-0e81350f877a', 'resourceVersion': '212282', 'creationTimestamp': '2025-09-12T13:33:59Z', 'labels': {'app': 'flannel', 'controller-revision-hash': '5cc678f779', 'k8s-app': 'flannel', 'pod-template-generation': '2', 'tier': 'node'}, 'ownerReferences': [{'apiVersion': 'apps/v1', 'kind': 'DaemonSet', 'name': 'kube-flannel-ds', 'uid': '498c66ad-8d8f-4b82-abce-7eff1439f0f1', 'controller': True, 'blockOwnerDeletion': True}], 'managedFields': [{'manager': 'kube-controller-manager', 'operation': 'Update', 'apiVersion': 'v1', 'time': '2025-09-12T13:33:59Z', 'fieldsType': 'FieldsV1', 'fieldsV1': {'f:metadata': {'f:generateName': {}, 'f:labels': {'.': {}, 'f:app': {}, 'f:controller-revision-hash': {}, 'f:k8s-app': {}, 'f:pod-template-generation': {}, 'f:tier': {}}, 'f:ownerReferences': {'.': {}, 'k:{"uid":"498c66ad-8d8f-4b82-abce-7eff1439f0f1"}': {}}}, 'f:spec': {'f:affinity': {'.': {}, 'f:nodeAffinity': {'.': {}, 'f:requiredDuringSchedulingIgnoredDuringExecution': {}}}, 'f:containers': {'k:{"name":"kube-flannel"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:env': {'.': {}, 'k:{"name":"CONT_WHEN_CACHE_NOT_READY"}': {'.': {}, 'f:name': {}, 'f:value': {}}, 'k:{"name":"EVENT_QUEUE_DEPTH"}': {'.': {}, 'f:name': {}, 'f:value': {}}, 'k:{"name":"POD_NAME"}': {'.': {}, 'f:name': {}, 'f:valueFrom': {'.': {}, 'f:fieldRef': {}}}, 'k:{"name":"POD_NAMESPACE"}': {'.': {}, 'f:name': {}, 'f:valueFrom': {'.': {}, 'f:fieldRef': {}}}}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {'.': {}, 'f:requests': {'.': {}, 'f:cpu': {}, 'f:memory': {}}}, 'f:securityContext': {'.': {}, 'f:capabilities': {'.': {}, 'f:add': {}}, 'f:privileged': {}}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/etc/kube-flannel/"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/run/flannel"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/run/xtables.lock"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}}, 'f:dnsPolicy': {}, 'f:enableServiceLinks': {}, 'f:hostNetwork': {}, 'f:initContainers': {'.': {}, 'k:{"name":"install-cni"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/etc/cni/net.d"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/etc/kube-flannel/"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}, 'k:{"name":"install-cni-plugin"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/opt/cni/bin"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}}, 'f:priorityClassName': {}, 'f:restartPolicy': {}, 'f:schedulerName': {}, 'f:securityContext': {}, 'f:serviceAccount': {}, 'f:serviceAccountName': {}, 'f:terminationGracePeriodSeconds': {}, 'f:tolerations': {}, 'f:volumes': {'.': {}, 'k:{"name":"cni"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"cni-plugin"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"flannel-cfg"}': {'.': {}, 'f:configMap': {'.': {}, 'f:defaultMode': {}, 'f:name': {}}, 'f:name': {}}, 'k:{"name":"run"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"xtables-lock"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}}}}}, {'manager': 'kubelet', 'operation': 'Update', 'apiVersion': 'v1', 'time': '2025-09-12T15:23:53Z', 'fieldsType': 'FieldsV1', 'fieldsV1': {'f:status': {'f:conditions': {'k:{"type":"ContainersReady"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:message': {}, 'f:reason': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"Initialized"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"PodReadyToStartContainers"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"Ready"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:message': {}, 'f:reason': {}, 'f:status': {}, 'f:type': {}}}, 'f:containerStatuses': {}, 'f:hostIP': {}, 'f:hostIPs': {}, 'f:initContainerStatuses': {}, 'f:phase': {}, 'f:podIP': {}, 'f:podIPs': {'.': {}, 'k:{"ip":"192.168.4.62"}': {'.': {}, 'f:ip': {}}}, 'f:startTime': {}}}, 'subresource': 'status'}]}, 'spec': {'volumes': [{'name': 'run', 'hostPath': {'path': '/run/flannel', 'type': ''}}, {'name': 'cni-plugin', 'hostPath': {'path': '/opt/cni/bin', 'type': ''}}, {'name': 'cni', 'hostPath': {'path': '/etc/cni/net.d', 'type': ''}}, {'name': 'flannel-cfg', 'configMap': {'name': 'kube-flannel-cfg', 'defaultMode': 420}}, {'name': 'xtables-lock', 'hostPath': {'path': '/run/xtables.lock', 'type': 'FileOrCreate'}}, {'name': 'kube-api-access-nrx29', 'projected': {'sources': [{'serviceAccountToken': {'expirationSeconds': 3607, 'path': 'token'}}, {'configMap': {'name': 'kube-root-ca.crt', 'items': [{'key': 'ca.crt', 'path': 'ca.crt'}]}}, {'downwardAPI': {'items': [{'path': 'namespace', 'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.namespace'}}]}}], 'defaultMode': 420}}], 'initContainers': [{'name': 'install-cni-plugin', 'image': 'docker.io/flannel/flannel-cni-plugin:v1.4.0-flannel1', 'command': ['cp'], 'args': ['-f', '/flannel', '/opt/cni/bin/flannel'], 'resources': {}, 'volumeMounts': [{'name': 'cni-plugin', 'mountPath': '/opt/cni/bin'}, {'name': 'kube-api-access-nrx29', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent'}, {'name': 'install-cni', 'image': 'docker.io/flannel/flannel:v0.24.2', 'command': ['cp'], 'args': ['-f', '/etc/kube-flannel/cni-conf.json', '/etc/cni/net.d/10-flannel.conflist'], 'resources': {}, 'volumeMounts': [{'name': 'cni', 'mountPath': '/etc/cni/net.d'}, {'name': 'flannel-cfg', 'mountPath': '/etc/kube-flannel/'}, {'name': 'kube-api-access-nrx29', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent'}], 'containers': [{'name': 'kube-flannel', 'image': 'docker.io/flannel/flannel:v0.24.2', 'command': ['/opt/bin/flanneld'], 'args': ['--ip-masq', '--kube-subnet-mgr'], 'env': [{'name': 'POD_NAME', 'valueFrom': {'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.name'}}}, {'name': 'POD_NAMESPACE', 'valueFrom': {'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.namespace'}}}, {'name': 'EVENT_QUEUE_DEPTH', 'value': '5000'}, {'name': 'CONT_WHEN_CACHE_NOT_READY', 'value': 'false'}], 'resources': {'requests': {'cpu': '100m', 'memory': '50Mi'}}, 'volumeMounts': [{'name': 'run', 'mountPath': '/run/flannel'}, {'name': 'flannel-cfg', 'mountPath': '/etc/kube-flannel/'}, {'name': 'xtables-lock', 'mountPath': '/run/xtables.lock'}, {'name': 'kube-api-access-nrx29', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent', 'securityContext': {'capabilities': {'add': ['NET_ADMIN', 'NET_RAW']}, 'privileged': False}}], 'restartPolicy': 'Always', 'terminationGracePeriodSeconds': 30, 'dnsPolicy': 'ClusterFirst', 'serviceAccountName': 'flannel', 'serviceAccount': 'flannel', 'nodeName': 'homelab', 'hostNetwork': True, 'securityContext': {}, 'affinity': {'nodeAffinity': {'requiredDuringSchedulingIgnoredDuringExecution': {'nodeSelectorTerms': [{'matchFields': [{'key': 'metadata.name', 'operator': 'In', 'values': ['homelab']}]}]}}}, 'schedulerName': 'default-scheduler', 'tolerations': [{'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/not-ready', 'operator': 'Exists', 'effect': 'NoExecute'}, {'key': 'node.kubernetes.io/unreachable', 'operator': 'Exists', 'effect': 'NoExecute'}, {'key': 'node.kubernetes.io/disk-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/memory-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/pid-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/unschedulable', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/network-unavailable', 'operator': 'Exists', 'effect': 'NoSchedule'}], 'priorityClassName': 'system-node-critical', 'priority': 2000001000, 'enableServiceLinks': True, 'preemptionPolicy': 'PreemptLowerPriority'}, 'status': {'phase': 'Running', 'conditions': [{'type': 'PodReadyToStartContainers', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T15:23:37Z'}, {'type': 'Initialized', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:34:06Z'}, {'type': 'Ready', 'status': 'False', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T15:23:36Z', 'reason': 'ContainersNotReady', 'message': 'containers with unready status: [kube-flannel]'}, {'type': 'ContainersReady', 'status': 'False', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T15:23:36Z', 'reason': 'ContainersNotReady', 'message': 'containers with unready status: [kube-flannel]'}, {'type': 'PodScheduled', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:33:59Z'}], 'hostIP': '192.168.4.62', 'hostIPs': [{'ip': '192.168.4.62'}], 'podIP': '192.168.4.62', 'podIPs': [{'ip': '192.168.4.62'}], 'startTime': '2025-09-12T13:33:59Z', 'initContainerStatuses': [{'name': 'install-cni-plugin', 'state': {'terminated': {'exitCode': 0, 'reason': 'Completed', 'startedAt': '2025-09-12T15:23:36Z', 'finishedAt': '2025-09-12T15:23:36Z', 'containerID': 'containerd://cd11f7b1fbe148474495f57b80e5be7e43166b915e2e8cd45c9bf07f44c0bd11'}}, 'lastState': {}, 'ready': True, 'restartCount': 16, 'image': 'docker.io/flannel/flannel-cni-plugin:v1.4.0-flannel1', 'imageID': 'docker.io/flannel/flannel-cni-plugin@sha256:743c25e5e477527d8e54faa3e5259fbbee3463a335de1690879fc74305edc79b', 'containerID': 'containerd://cd11f7b1fbe148474495f57b80e5be7e43166b915e2e8cd45c9bf07f44c0bd11', 'started': False}, {'name': 'install-cni', 'state': {'terminated': {'exitCode': 0, 'reason': 'Completed', 'startedAt': '2025-09-12T15:23:37Z', 'finishedAt': '2025-09-12T15:23:37Z', 'containerID': 'containerd://e25b87579ebf9cfdadca291e10ea3c9117c09943ccff3f26426f1ec711984306'}}, 'lastState': {}, 'ready': True, 'restartCount': 0, 'image': 'docker.io/flannel/flannel:v0.24.2', 'imageID': 'docker.io/flannel/flannel@sha256:2a2b74a762a5d99517659f940e3f2ad774de293d41fce6a78378df6fe9320173', 'containerID': 'containerd://e25b87579ebf9cfdadca291e10ea3c9117c09943ccff3f26426f1ec711984306', 'started': False}], 'containerStatuses': [{'name': 'kube-flannel', 'state': {'waiting': {'reason': 'CrashLoopBackOff', 'message': 'back-off 5m0s restarting failed container=kube-flannel pod=kube-flannel-ds-hns7m_kube-flannel(1fc6bc2f-e94a-4f81-ab3f-0e81350f877a)'}}, 'lastState': {'terminated': {'exitCode': 0, 'reason': 'Completed', 'startedAt': '2025-09-12T15:22:22Z', 'finishedAt': '2025-09-12T15:23:36Z', 'containerID': 'containerd://a3958f4a4f071fde9428f187c09de7503b3ca4e4fc86d44fec66e5ade29d6790'}}, 'ready': False, 'restartCount': 21, 'image': 'docker.io/flannel/flannel:v0.24.2', 'imageID': 'docker.io/flannel/flannel@sha256:2a2b74a762a5d99517659f940e3f2ad774de293d41fce6a78378df6fe9320173', 'containerID': 'containerd://a3958f4a4f071fde9428f187c09de7503b3ca4e4fc86d44fec66e5ade29d6790', 'started': False}], 'qosClass': 'Burstable'}, 'apiVersion': 'v1', 'kind': 'Pod'}) =>
  msg: Flannel pod kube-flannel-ds-hns7m on node homelab is Running
ok: [masternode] => (item={'metadata': {'name': 'kube-flannel-ds-zmn26', 'generateName': 'kube-flannel-ds-', 'namespace': 'kube-flannel', 'uid': 'faf3707c-3350-418d-a288-0d0fe0f57075', 'resourceVersion': '202000', 'creationTimestamp': '2025-09-12T13:34:08Z', 'labels': {'app': 'flannel', 'controller-revision-hash': '5cc678f779', 'k8s-app': 'flannel', 'pod-template-generation': '2', 'tier': 'node'}, 'ownerReferences': [{'apiVersion': 'apps/v1', 'kind': 'DaemonSet', 'name': 'kube-flannel-ds', 'uid': '498c66ad-8d8f-4b82-abce-7eff1439f0f1', 'controller': True, 'blockOwnerDeletion': True}], 'managedFields': [{'manager': 'kube-controller-manager', 'operation': 'Update', 'apiVersion': 'v1', 'time': '2025-09-12T13:34:08Z', 'fieldsType': 'FieldsV1', 'fieldsV1': {'f:metadata': {'f:generateName': {}, 'f:labels': {'.': {}, 'f:app': {}, 'f:controller-revision-hash': {}, 'f:k8s-app': {}, 'f:pod-template-generation': {}, 'f:tier': {}}, 'f:ownerReferences': {'.': {}, 'k:{"uid":"498c66ad-8d8f-4b82-abce-7eff1439f0f1"}': {}}}, 'f:spec': {'f:affinity': {'.': {}, 'f:nodeAffinity': {'.': {}, 'f:requiredDuringSchedulingIgnoredDuringExecution': {}}}, 'f:containers': {'k:{"name":"kube-flannel"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:env': {'.': {}, 'k:{"name":"CONT_WHEN_CACHE_NOT_READY"}': {'.': {}, 'f:name': {}, 'f:value': {}}, 'k:{"name":"EVENT_QUEUE_DEPTH"}': {'.': {}, 'f:name': {}, 'f:value': {}}, 'k:{"name":"POD_NAME"}': {'.': {}, 'f:name': {}, 'f:valueFrom': {'.': {}, 'f:fieldRef': {}}}, 'k:{"name":"POD_NAMESPACE"}': {'.': {}, 'f:name': {}, 'f:valueFrom': {'.': {}, 'f:fieldRef': {}}}}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {'.': {}, 'f:requests': {'.': {}, 'f:cpu': {}, 'f:memory': {}}}, 'f:securityContext': {'.': {}, 'f:capabilities': {'.': {}, 'f:add': {}}, 'f:privileged': {}}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/etc/kube-flannel/"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/run/flannel"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/run/xtables.lock"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}}, 'f:dnsPolicy': {}, 'f:enableServiceLinks': {}, 'f:hostNetwork': {}, 'f:initContainers': {'.': {}, 'k:{"name":"install-cni"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/etc/cni/net.d"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}, 'k:{"mountPath":"/etc/kube-flannel/"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}, 'k:{"name":"install-cni-plugin"}': {'.': {}, 'f:args': {}, 'f:command': {}, 'f:image': {}, 'f:imagePullPolicy': {}, 'f:name': {}, 'f:resources': {}, 'f:terminationMessagePath': {}, 'f:terminationMessagePolicy': {}, 'f:volumeMounts': {'.': {}, 'k:{"mountPath":"/opt/cni/bin"}': {'.': {}, 'f:mountPath': {}, 'f:name': {}}}}}, 'f:priorityClassName': {}, 'f:restartPolicy': {}, 'f:schedulerName': {}, 'f:securityContext': {}, 'f:serviceAccount': {}, 'f:serviceAccountName': {}, 'f:terminationGracePeriodSeconds': {}, 'f:tolerations': {}, 'f:volumes': {'.': {}, 'k:{"name":"cni"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"cni-plugin"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"flannel-cfg"}': {'.': {}, 'f:configMap': {'.': {}, 'f:defaultMode': {}, 'f:name': {}}, 'f:name': {}}, 'k:{"name":"run"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}, 'k:{"name":"xtables-lock"}': {'.': {}, 'f:hostPath': {'.': {}, 'f:path': {}, 'f:type': {}}, 'f:name': {}}}}}}, {'manager': 'kubelet', 'operation': 'Update', 'apiVersion': 'v1', 'time': '2025-09-12T13:34:27Z', 'fieldsType': 'FieldsV1', 'fieldsV1': {'f:status': {'f:conditions': {'k:{"type":"ContainersReady"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"Initialized"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"PodReadyToStartContainers"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}, 'k:{"type":"Ready"}': {'.': {}, 'f:lastProbeTime': {}, 'f:lastTransitionTime': {}, 'f:status': {}, 'f:type': {}}}, 'f:containerStatuses': {}, 'f:hostIP': {}, 'f:hostIPs': {}, 'f:initContainerStatuses': {}, 'f:phase': {}, 'f:podIP': {}, 'f:podIPs': {'.': {}, 'k:{"ip":"192.168.4.61"}': {'.': {}, 'f:ip': {}}}, 'f:startTime': {}}}, 'subresource': 'status'}]}, 'spec': {'volumes': [{'name': 'run', 'hostPath': {'path': '/run/flannel', 'type': ''}}, {'name': 'cni-plugin', 'hostPath': {'path': '/opt/cni/bin', 'type': ''}}, {'name': 'cni', 'hostPath': {'path': '/etc/cni/net.d', 'type': ''}}, {'name': 'flannel-cfg', 'configMap': {'name': 'kube-flannel-cfg', 'defaultMode': 420}}, {'name': 'xtables-lock', 'hostPath': {'path': '/run/xtables.lock', 'type': 'FileOrCreate'}}, {'name': 'kube-api-access-fbksv', 'projected': {'sources': [{'serviceAccountToken': {'expirationSeconds': 3607, 'path': 'token'}}, {'configMap': {'name': 'kube-root-ca.crt', 'items': [{'key': 'ca.crt', 'path': 'ca.crt'}]}}, {'downwardAPI': {'items': [{'path': 'namespace', 'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.namespace'}}]}}], 'defaultMode': 420}}], 'initContainers': [{'name': 'install-cni-plugin', 'image': 'docker.io/flannel/flannel-cni-plugin:v1.4.0-flannel1', 'command': ['cp'], 'args': ['-f', '/flannel', '/opt/cni/bin/flannel'], 'resources': {}, 'volumeMounts': [{'name': 'cni-plugin', 'mountPath': '/opt/cni/bin'}, {'name': 'kube-api-access-fbksv', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent'}, {'name': 'install-cni', 'image': 'docker.io/flannel/flannel:v0.24.2', 'command': ['cp'], 'args': ['-f', '/etc/kube-flannel/cni-conf.json', '/etc/cni/net.d/10-flannel.conflist'], 'resources': {}, 'volumeMounts': [{'name': 'cni', 'mountPath': '/etc/cni/net.d'}, {'name': 'flannel-cfg', 'mountPath': '/etc/kube-flannel/'}, {'name': 'kube-api-access-fbksv', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent'}], 'containers': [{'name': 'kube-flannel', 'image': 'docker.io/flannel/flannel:v0.24.2', 'command': ['/opt/bin/flanneld'], 'args': ['--ip-masq', '--kube-subnet-mgr'], 'env': [{'name': 'POD_NAME', 'valueFrom': {'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.name'}}}, {'name': 'POD_NAMESPACE', 'valueFrom': {'fieldRef': {'apiVersion': 'v1', 'fieldPath': 'metadata.namespace'}}}, {'name': 'EVENT_QUEUE_DEPTH', 'value': '5000'}, {'name': 'CONT_WHEN_CACHE_NOT_READY', 'value': 'false'}], 'resources': {'requests': {'cpu': '100m', 'memory': '50Mi'}}, 'volumeMounts': [{'name': 'run', 'mountPath': '/run/flannel'}, {'name': 'flannel-cfg', 'mountPath': '/etc/kube-flannel/'}, {'name': 'xtables-lock', 'mountPath': '/run/xtables.lock'}, {'name': 'kube-api-access-fbksv', 'readOnly': True, 'mountPath': '/var/run/secrets/kubernetes.io/serviceaccount'}], 'terminationMessagePath': '/dev/termination-log', 'terminationMessagePolicy': 'File', 'imagePullPolicy': 'IfNotPresent', 'securityContext': {'capabilities': {'add': ['NET_ADMIN', 'NET_RAW']}, 'privileged': False}}], 'restartPolicy': 'Always', 'terminationGracePeriodSeconds': 30, 'dnsPolicy': 'ClusterFirst', 'serviceAccountName': 'flannel', 'serviceAccount': 'flannel', 'nodeName': 'storagenodet3500', 'hostNetwork': True, 'securityContext': {}, 'affinity': {'nodeAffinity': {'requiredDuringSchedulingIgnoredDuringExecution': {'nodeSelectorTerms': [{'matchFields': [{'key': 'metadata.name', 'operator': 'In', 'values': ['storagenodet3500']}]}]}}}, 'schedulerName': 'default-scheduler', 'tolerations': [{'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/not-ready', 'operator': 'Exists', 'effect': 'NoExecute'}, {'key': 'node.kubernetes.io/unreachable', 'operator': 'Exists', 'effect': 'NoExecute'}, {'key': 'node.kubernetes.io/disk-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/memory-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/pid-pressure', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/unschedulable', 'operator': 'Exists', 'effect': 'NoSchedule'}, {'key': 'node.kubernetes.io/network-unavailable', 'operator': 'Exists', 'effect': 'NoSchedule'}], 'priorityClassName': 'system-node-critical', 'priority': 2000001000, 'enableServiceLinks': True, 'preemptionPolicy': 'PreemptLowerPriority'}, 'status': {'phase': 'Running', 'conditions': [{'type': 'PodReadyToStartContainers', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:34:13Z'}, {'type': 'Initialized', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:34:26Z'}, {'type': 'Ready', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:34:27Z'}, {'type': 'ContainersReady', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:34:27Z'}, {'type': 'PodScheduled', 'status': 'True', 'lastProbeTime': None, 'lastTransitionTime': '2025-09-12T13:34:08Z'}], 'hostIP': '192.168.4.61', 'hostIPs': [{'ip': '192.168.4.61'}], 'podIP': '192.168.4.61', 'podIPs': [{'ip': '192.168.4.61'}], 'startTime': '2025-09-12T13:34:08Z', 'initContainerStatuses': [{'name': 'install-cni-plugin', 'state': {'terminated': {'exitCode': 0, 'reason': 'Completed', 'startedAt': '2025-09-12T13:34:13Z', 'finishedAt': '2025-09-12T13:34:13Z', 'containerID': 'containerd://15656a969b1c98edd520af2ceb4ab1a9199d657f723b71329d7ee452a0b82b0e'}}, 'lastState': {}, 'ready': True, 'restartCount': 0, 'image': 'docker.io/flannel/flannel-cni-plugin:v1.4.0-flannel1', 'imageID': 'docker.io/flannel/flannel-cni-plugin@sha256:743c25e5e477527d8e54faa3e5259fbbee3463a335de1690879fc74305edc79b', 'containerID': 'containerd://15656a969b1c98edd520af2ceb4ab1a9199d657f723b71329d7ee452a0b82b0e', 'started': False}, {'name': 'install-cni', 'state': {'terminated': {'exitCode': 0, 'reason': 'Completed', 'startedAt': '2025-09-12T13:34:23Z', 'finishedAt': '2025-09-12T13:34:23Z', 'containerID': 'containerd://0426caecbdd6d30cf618c0376dd36fad494108408c1f27fd9ef4451301b33d69'}}, 'lastState': {}, 'ready': True, 'restartCount': 0, 'image': 'docker.io/flannel/flannel:v0.24.2', 'imageID': 'docker.io/flannel/flannel@sha256:2a2b74a762a5d99517659f940e3f2ad774de293d41fce6a78378df6fe9320173', 'containerID': 'containerd://0426caecbdd6d30cf618c0376dd36fad494108408c1f27fd9ef4451301b33d69', 'started': False}], 'containerStatuses': [{'name': 'kube-flannel', 'state': {'running': {'startedAt': '2025-09-12T13:34:27Z'}}, 'lastState': {}, 'ready': True, 'restartCount': 0, 'image': 'docker.io/flannel/flannel:v0.24.2', 'imageID': 'docker.io/flannel/flannel@sha256:2a2b74a762a5d99517659f940e3f2ad774de293d41fce6a78378df6fe9320173', 'containerID': 'containerd://28514fcc0ce6b5b5b2db60c41eb22b1e833046831b7f174c8bda1795cf8beafc', 'started': True}], 'qosClass': 'Burstable'}, 'apiVersion': 'v1', 'kind': 'Pod'}) =>
  msg: Flannel pod kube-flannel-ds-zmn26 on node storagenodet3500 is Running

PLAY [Deploy and Verify Monitoring Stack] **************************************

TASK [Check existing Prometheus Deployment selector] ***************************
task path: /srv/monitoring_data/VMStation/ansible/playbooks/verify-cluster.yml:120
<192.168.4.63> ESTABLISH LOCAL CONNECTION FOR USER: root
<192.168.4.63> EXEC /bin/sh -c 'echo ~root && sleep 0'
<192.168.4.63> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /root/.ansible/tmp `"&& mkdir "` echo /root/.ansible/tmp/ansible-tmp-1757690884.5766983-1179582-227655468938773 `" && echo ansible-tmp-1757690884.5766983-1179582-227655468938773="` echo /root/.ansible/tmp/ansible-tmp-1757690884.5766983-1179582-227655468938773 `" ) && sleep 0'
Using module file /root/.ansible/collections/ansible_collections/kubernetes/core/plugins/modules/k8s_info.py
<192.168.4.63> PUT /root/.ansible/tmp/ansible-local-11791302wsf7ye0/tmp__ryi2ex TO /root/.ansible/tmp/ansible-tmp-1757690884.5766983-1179582-227655468938773/AnsiballZ_k8s_info.py
<192.168.4.63> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1757690884.5766983-1179582-227655468938773/ /root/.ansible/tmp/ansible-tmp-1757690884.5766983-1179582-227655468938773/AnsiballZ_k8s_info.py && sleep 0'
<192.168.4.63> EXEC /bin/sh -c '/usr/bin/python3 /root/.ansible/tmp/ansible-tmp-1757690884.5766983-1179582-227655468938773/AnsiballZ_k8s_info.py && sleep 0'
<192.168.4.63> EXEC /bin/sh -c 'rm -f -r /root/.ansible/tmp/ansible-tmp-1757690884.5766983-1179582-227655468938773/ > /dev/null 2>&1 && sleep 0'
ok: [masternode] => changed=false
  api_found: true
  failed_when_result: false
  invocation:
    module_args:
      api_key: null
      api_version: apps/v1
      ca_cert: null
      client_cert: null
      client_key: null
      context: null
      field_selectors: []
      hidden_fields: null
      host: null
      impersonate_groups: null
      impersonate_user: null
      kind: Deployment
      kubeconfig: VALUE_SPECIFIED_IN_NO_LOG_PARAMETER
      label_selectors: []
      name: prometheus
      namespace: monitoring
      no_proxy: null
      password: null
      persist_config: null
      proxy: null
      proxy_headers: null
      username: null
      validate_certs: null
      wait: false
      wait_condition: null
      wait_sleep: 5
      wait_timeout: 120
  resources: []

TASK [Delete Prometheus Deployment if selector doesn't match manifest expectation] ***
task path: /srv/monitoring_data/VMStation/ansible/playbooks/verify-cluster.yml:130
skipping: [masternode] => changed=false
  skip_reason: Conditional result was False

TASK [Check existing Grafana Deployment selector] ******************************
task path: /srv/monitoring_data/VMStation/ansible/playbooks/verify-cluster.yml:140
<192.168.4.63> ESTABLISH LOCAL CONNECTION FOR USER: root
<192.168.4.63> EXEC /bin/sh -c 'echo ~root && sleep 0'
<192.168.4.63> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /root/.ansible/tmp `"&& mkdir "` echo /root/.ansible/tmp/ansible-tmp-1757690885.321858-1179610-23132007339294 `" && echo ansible-tmp-1757690885.321858-1179610-23132007339294="` echo /root/.ansible/tmp/ansible-tmp-1757690885.321858-1179610-23132007339294 `" ) && sleep 0'
Using module file /root/.ansible/collections/ansible_collections/kubernetes/core/plugins/modules/k8s_info.py
<192.168.4.63> PUT /root/.ansible/tmp/ansible-local-11791302wsf7ye0/tmpy7gm9k72 TO /root/.ansible/tmp/ansible-tmp-1757690885.321858-1179610-23132007339294/AnsiballZ_k8s_info.py
<192.168.4.63> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1757690885.321858-1179610-23132007339294/ /root/.ansible/tmp/ansible-tmp-1757690885.321858-1179610-23132007339294/AnsiballZ_k8s_info.py && sleep 0'
<192.168.4.63> EXEC /bin/sh -c '/usr/bin/python3 /root/.ansible/tmp/ansible-tmp-1757690885.321858-1179610-23132007339294/AnsiballZ_k8s_info.py && sleep 0'
<192.168.4.63> EXEC /bin/sh -c 'rm -f -r /root/.ansible/tmp/ansible-tmp-1757690885.321858-1179610-23132007339294/ > /dev/null 2>&1 && sleep 0'
ok: [masternode] => changed=false
  api_found: true
  failed_when_result: false
  invocation:
    module_args:
      api_key: null
      api_version: apps/v1
      ca_cert: null
      client_cert: null
      client_key: null
      context: null
      field_selectors: []
      hidden_fields: null
      host: null
      impersonate_groups: null
      impersonate_user: null
      kind: Deployment
      kubeconfig: VALUE_SPECIFIED_IN_NO_LOG_PARAMETER
      label_selectors: []
      name: grafana
      namespace: monitoring
      no_proxy: null
      password: null
      persist_config: null
      proxy: null
      proxy_headers: null
      username: null
      validate_certs: null
      wait: false
      wait_condition: null
      wait_sleep: 5
      wait_timeout: 120
  resources: []

TASK [Delete Grafana Deployment if selector doesn't match manifest expectation] ***
task path: /srv/monitoring_data/VMStation/ansible/playbooks/verify-cluster.yml:150
skipping: [masternode] => changed=false
  skip_reason: Conditional result was False

TASK [Deploy monitoring namespace and components] ******************************
task path: /srv/monitoring_data/VMStation/ansible/playbooks/verify-cluster.yml:160
<192.168.4.63> ESTABLISH LOCAL CONNECTION FOR USER: root
<192.168.4.63> EXEC /bin/sh -c 'echo ~root && sleep 0'
<192.168.4.63> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /root/.ansible/tmp `"&& mkdir "` echo /root/.ansible/tmp/ansible-tmp-1757690886.0700874-1179644-109828043863479 `" && echo ansible-tmp-1757690886.0700874-1179644-109828043863479="` echo /root/.ansible/tmp/ansible-tmp-1757690886.0700874-1179644-109828043863479 `" ) && sleep 0'
Loading collection cloud.common from /usr/lib/python3/dist-packages/ansible_collections/cloud/common
Using module file /root/.ansible/collections/ansible_collections/kubernetes/core/plugins/modules/k8s.py
<192.168.4.63> PUT /root/.ansible/tmp/ansible-local-11791302wsf7ye0/tmpi5s6f9z7 TO /root/.ansible/tmp/ansible-tmp-1757690886.0700874-1179644-109828043863479/AnsiballZ_k8s.py
<192.168.4.63> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1757690886.0700874-1179644-109828043863479/ /root/.ansible/tmp/ansible-tmp-1757690886.0700874-1179644-109828043863479/AnsiballZ_k8s.py && sleep 0'
<192.168.4.63> EXEC /bin/sh -c '/usr/bin/python3 /root/.ansible/tmp/ansible-tmp-1757690886.0700874-1179644-109828043863479/AnsiballZ_k8s.py && sleep 0'
<192.168.4.63> EXEC /bin/sh -c 'rm -f -r /root/.ansible/tmp/ansible-tmp-1757690886.0700874-1179644-109828043863479/ > /dev/null 2>&1 && sleep 0'
The full traceback is:
  File "/tmp/ansible_kubernetes.core.k8s_payload_r7xyu5f8/ansible_kubernetes.core.k8s_payload.zip/ansible_collections/kubernetes/core/plugins/module_utils/k8s/runner.py", line 101, in run_module
    result = perform_action(svc, definition, module.params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ansible_kubernetes.core.k8s_payload_r7xyu5f8/ansible_kubernetes.core.k8s_payload.zip/ansible_collections/kubernetes/core/plugins/module_utils/k8s/runner.py", line 187, in perform_action
    instance, warnings = svc.create(resource, definition)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ansible_kubernetes.core.k8s_payload_r7xyu5f8/ansible_kubernetes.core.k8s_payload.zip/ansible_collections/kubernetes/core/plugins/module_utils/k8s/service.py", line 356, in create
    raise CoreException(msg) from e
failed: [masternode] (item=/srv/monitoring_data/VMStation/ansible/playbooks/../../manifests/monitoring/prometheus.yaml) => changed=false
  ansible_loop_var: item
  invocation:
    module_args:
      api_key: null
      api_version: v1
      append_hash: false
      apply: false
      ca_cert: null
      client_cert: null
      client_key: null
      context: null
      continue_on_error: false
      delete_all: false
      delete_options: null
      force: false
      generate_name: null
      hidden_fields: null
      host: null
      impersonate_groups: null
      impersonate_user: null
      kind: null
      kubeconfig: VALUE_SPECIFIED_IN_NO_LOG_PARAMETER
      label_selectors: null
      merge_type: null
      name: null
      namespace: null
      no_proxy: null
      password: null
      persist_config: null
      proxy: null
      proxy_headers: null
      resource_definition: null
      server_side_apply: null
      src: /srv/monitoring_data/VMStation/manifests/monitoring/prometheus.yaml
      state: present
      template: null
      username: null
      validate: null
      validate_certs: null
      wait: false
      wait_condition: null
      wait_sleep: 5
      wait_timeout: 120
  item: /srv/monitoring_data/VMStation/ansible/playbooks/../../manifests/monitoring/prometheus.yaml
  msg: 'Failed to create object: b''{"kind":"Status","apiVersion":"v1","metadata":{},"status":"Failure","message":"Deployment.apps \\"prometheus\\" is invalid: spec.selector: Invalid value: v1.LabelSelector{MatchLabels:map[string]string(nil), MatchExpressions:[]v1.LabelSelectorRequirement(nil)}: empty selector is invalid for deployment","reason":"Invalid","details":{"name":"prometheus","group":"apps","kind":"Deployment","causes":[{"reason":"FieldValueInvalid","message":"Invalid value: v1.LabelSelector{MatchLabels:map[string]string(nil), MatchExpressions:[]v1.LabelSelectorRequirement(nil)}: empty selector is invalid for deployment","field":"spec.selector"}]},"code":422}\n'''
  reason: Unprocessable Entity
<192.168.4.63> EXEC /bin/sh -c 'echo ~root && sleep 0'
<192.168.4.63> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /root/.ansible/tmp `"&& mkdir "` echo /root/.ansible/tmp/ansible-tmp-1757690887.0076845-1179644-124472543335718 `" && echo ansible-tmp-1757690887.0076845-1179644-124472543335718="` echo /root/.ansible/tmp/ansible-tmp-1757690887.0076845-1179644-124472543335718 `" ) && sleep 0'
Using module file /root/.ansible/collections/ansible_collections/kubernetes/core/plugins/modules/k8s.py
<192.168.4.63> PUT /root/.ansible/tmp/ansible-local-11791302wsf7ye0/tmp00d9aoef TO /root/.ansible/tmp/ansible-tmp-1757690887.0076845-1179644-124472543335718/AnsiballZ_k8s.py
<192.168.4.63> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1757690887.0076845-1179644-124472543335718/ /root/.ansible/tmp/ansible-tmp-1757690887.0076845-1179644-124472543335718/AnsiballZ_k8s.py && sleep 0'
<192.168.4.63> EXEC /bin/sh -c '/usr/bin/python3 /root/.ansible/tmp/ansible-tmp-1757690887.0076845-1179644-124472543335718/AnsiballZ_k8s.py && sleep 0'
<192.168.4.63> EXEC /bin/sh -c 'rm -f -r /root/.ansible/tmp/ansible-tmp-1757690887.0076845-1179644-124472543335718/ > /dev/null 2>&1 && sleep 0'
The full traceback is:
  File "/tmp/ansible_kubernetes.core.k8s_payload_syu4jcf5/ansible_kubernetes.core.k8s_payload.zip/ansible_collections/kubernetes/core/plugins/module_utils/k8s/runner.py", line 101, in run_module
    result = perform_action(svc, definition, module.params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ansible_kubernetes.core.k8s_payload_syu4jcf5/ansible_kubernetes.core.k8s_payload.zip/ansible_collections/kubernetes/core/plugins/module_utils/k8s/runner.py", line 187, in perform_action
    instance, warnings = svc.create(resource, definition)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ansible_kubernetes.core.k8s_payload_syu4jcf5/ansible_kubernetes.core.k8s_payload.zip/ansible_collections/kubernetes/core/plugins/module_utils/k8s/service.py", line 356, in create
    raise CoreException(msg) from e
failed: [masternode] (item=/srv/monitoring_data/VMStation/ansible/playbooks/../../manifests/monitoring/grafana.yaml) => changed=false
  ansible_loop_var: item
  invocation:
    module_args:
      api_key: null
      api_version: v1
      append_hash: false
      apply: false
      ca_cert: null
      client_cert: null
      client_key: null
      context: null
      continue_on_error: false
      delete_all: false
      delete_options: null
      force: false
      generate_name: null
      hidden_fields: null
      host: null
      impersonate_groups: null
      impersonate_user: null
      kind: null
      kubeconfig: VALUE_SPECIFIED_IN_NO_LOG_PARAMETER
      label_selectors: null
      merge_type: null
      name: null
      namespace: null
      no_proxy: null
      password: null
      persist_config: null
      proxy: null
      proxy_headers: null
      resource_definition: null
      server_side_apply: null
      src: /srv/monitoring_data/VMStation/manifests/monitoring/grafana.yaml
      state: present
      template: null
      username: null
      validate: null
      validate_certs: null
      wait: false
      wait_condition: null
      wait_sleep: 5
      wait_timeout: 120
  item: /srv/monitoring_data/VMStation/ansible/playbooks/../../manifests/monitoring/grafana.yaml
  msg: 'Failed to create object: b''{"kind":"Status","apiVersion":"v1","metadata":{},"status":"Failure","message":"Deployment.apps \\"grafana\\" is invalid: spec.selector: Invalid value: v1.LabelSelector{MatchLabels:map[string]string(nil), MatchExpressions:[]v1.LabelSelectorRequirement(nil)}: empty selector is invalid for deployment","reason":"Invalid","details":{"name":"grafana","group":"apps","kind":"Deployment","causes":[{"reason":"FieldValueInvalid","message":"Invalid value: v1.LabelSelector{MatchLabels:map[string]string(nil), MatchExpressions:[]v1.LabelSelectorRequirement(nil)}: empty selector is invalid for deployment","field":"spec.selector"}]},"code":422}\n'''
  reason: Unprocessable Entity

PLAY RECAP *********************************************************************
masternode                 : ok=16   changed=0    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0

[ERROR] ❌ Cluster verification failed!
[INFO] Run smoke test for quick diagnosis: ./deploy-cluster.sh smoke-test
