- hosts: localhost
  connection: local
  gather_facts: false
  tasks:
    - name: Ensure drone namespace exists
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: drone

    - name: Create drone secrets from group_vars
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Secret
          metadata:
            name: drone-secrets
            namespace: drone
          type: Opaque
          stringData:
            rpc-secret: "{{ drone_rpc_secret | default('changeme') }}"
            github-client-id: "{{ drone_github_client_id | default('') }}"
            github-client-secret: "{{ drone_github_client_secret | default('') }}"
            server-host: "{{ drone_server_host | default('') }}"