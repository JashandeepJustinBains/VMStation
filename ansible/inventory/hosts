
---
# VMStation Kubernetes Cluster Inventory
# Defines the three-node cluster topology as specified in requirements

monitoring_nodes:
	hosts:
		masternode:
			ansible_host: 192.168.4.63
			ansible_user: root
			ansible_connection: local
			wol_mac: '00:e0:4c:68:cb:bf brd ff:ff:ff:ff:ff:ff'
			node_role: control-plane
			node_labels:
				- "node-role.kubernetes.io/control-plane="
				- "node.kubernetes.io/instance-type=control-plane"
				- "vmstation.io/role=monitoring"

storage_nodes:
	hosts:
		storagenodet3500:
			ansible_host: 192.168.4.61
			ansible_user: root
			ansible_ssh_private_key_file: ~/.ssh/id_k3s
			wol_mac: 'b8:ac:6f:7e:6c:9d brd ff:ff:ff:ff:ff:ff'
			node_role: worker
			node_labels:
				- "node.kubernetes.io/instance-type=storage"
				- "vmstation.io/role=storage"
				- "jellyfin.vmstation.io/preferred=true"

compute_nodes:
	hosts:
		homelab:
			ansible_host: 192.168.4.62
			ansible_user: jashandeepjustinbains
			ansible_ssh_private_key_file: ~/.ssh/id_k3s
			wol_mac: 'd0:94:66:30:d6:63 brd ff:ff:ff:ff:ff:ff'
			node_role: worker
			node_labels:
				- "node.kubernetes.io/instance-type=compute"
				- "vmstation.io/role=compute"
			os_family: RedHat
			os_version: "10"

# Group variables for all nodes
all:
	vars:
		# Kubernetes configuration
		kubernetes_version: "1.29"
		pod_network_cidr: "10.244.0.0/16"
		service_network_cidr: "10.96.0.0/12"
    
		# Container runtime
		container_runtime: containerd
		cri_socket: "unix:///var/run/containerd/containerd.sock"
    
		# Cluster endpoint
		control_plane_endpoint: "192.168.4.63:6443"
    
		# CNI configuration
		cni_plugin: flannel
    
		# System configuration
		disable_swap: true
		setup_firewall: false  # Assume firewall is managed externally
    
		# SSH configuration
		ansible_ssh_common_args: '-o StrictHostKeyChecking=no'
    
	children:
		monitoring_nodes:
			vars:
				# Monitoring-specific configuration
				schedule_monitoring_pods: true
				install_monitoring_stack: true
        
		storage_nodes:
			vars:
				# Storage-specific configuration
				schedule_jellyfin: true
				media_storage_path: /srv/media
				jellyfin_config_path: /var/lib/jellyfin
        
		compute_nodes:
			vars:
				# Compute-specific configuration
				schedule_general_workloads: true
				# RHEL-specific settings
				rhel_subscription_required: false  # Assume subscription is managed
